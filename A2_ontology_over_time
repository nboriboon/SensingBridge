AddSheet ( "0" ) ;
SetSheetState ( { "sheetId" : "0" , "sheetLabel" : "Sheet1" , "backgroundColor" : null , "hideHeaders" : null , "hideBorders" : null , "height" : null , "width" : null , "borderSize" : 2 } ) ;
AddPanel ( panel = [ "0" ] , sheet = [ "0" ] ) ;
SetPanelState ( "<encode>{"panelId":"0","panelLabel":null,"sheetId":"0","view":"visualization","viewOptions":"{\"type\":\"echarts\"}","numCollect":2000,"viewOptionsMap":{"visualization":{"type":"echarts"}},"config":{"type":"golden"},"ornaments":{},"events":{"onSingleClick":{"Unfilter":[{"disabledVisuals":["Grid","Sunburst"],"default":true,"query":"(<Frame> | UnfilterFrame(<SelectedColumn>));","options":{},"refresh":false,"disabled":false,"panel":""}]},"onBrush":{"Filter":[{"default":true,"query":"if((IsEmpty(<SelectedValues>)),(<Frame> | UnfilterFrame(<SelectedColumn>)), (<Frame> | SetFrameFilter(<SelectedColumn>==<SelectedValues>)));","options":{},"refresh":false,"disabled":false,"panel":""}]}},"comments":{},"filters":[],"order":[{"type":"CUSTOM","content":{"columnToSort":{"type":"COLUMN","content":{"table":"month","column":"PRIM_KEY_PLACEHOLDER","alias":"month","tableAlias":null}},"values":["May      ","June     ","July     ","August   ","September"]}}],"cbv":[],"lastQs":{"qsType":"FRAME","frameName":"POSTGRES_FRAME741331","frameType":"R","isDistinct":true,"overrideImplicit":false,"limit":2000,"offset":0,"queryAll":false,"selectors":[{"type":"COLUMN","content":{"table":"month","column":"PRIM_KEY_PLACEHOLDER","alias":"month","tableAlias":null}},{"type":"COLUMN","content":{"table":"Collaborate","column":"PRIM_KEY_PLACEHOLDER","alias":"Collaborate","tableAlias":null}},{"type":"COLUMN","content":{"table":"Complication","column":"PRIM_KEY_PLACEHOLDER","alias":"Complication","tableAlias":null}},{"type":"COLUMN","content":{"table":"Develop","column":"PRIM_KEY_PLACEHOLDER","alias":"Develop","tableAlias":null}},{"type":"COLUMN","content":{"table":"Hiring","column":"PRIM_KEY_PLACEHOLDER","alias":"Hiring","tableAlias":null}},{"type":"COLUMN","content":{"table":"Investment","column":"PRIM_KEY_PLACEHOLDER","alias":"Investment","tableAlias":null}},{"type":"COLUMN","content":{"table":"Policy","column":"PRIM_KEY_PLACEHOLDER","alias":"Policy","tableAlias":null}}],"withPanels":["0"]},"lastQueryStructMap":{"0":{"qsType":"FRAME","frameName":"POSTGRES_FRAME741331","frameType":"R","isDistinct":true,"overrideImplicit":false,"limit":2000,"offset":0,"queryAll":false,"selectors":[{"type":"COLUMN","content":{"table":"month","column":"PRIM_KEY_PLACEHOLDER","alias":"month","tableAlias":null}},{"type":"COLUMN","content":{"table":"Collaborate","column":"PRIM_KEY_PLACEHOLDER","alias":"Collaborate","tableAlias":null}},{"type":"COLUMN","content":{"table":"Complication","column":"PRIM_KEY_PLACEHOLDER","alias":"Complication","tableAlias":null}},{"type":"COLUMN","content":{"table":"Develop","column":"PRIM_KEY_PLACEHOLDER","alias":"Develop","tableAlias":null}},{"type":"COLUMN","content":{"table":"Hiring","column":"PRIM_KEY_PLACEHOLDER","alias":"Hiring","tableAlias":null}},{"type":"COLUMN","content":{"table":"Investment","column":"PRIM_KEY_PLACEHOLDER","alias":"Investment","tableAlias":null}},{"type":"COLUMN","content":{"table":"Policy","column":"PRIM_KEY_PLACEHOLDER","alias":"Policy","tableAlias":null}}],"withPanels":["0"]}},"lastTaskOptions":{"options":{"0":{"layout":"Line","alignment":{"tooltip":[],"label":["month"],"value":["Collaborate","Complication","Develop","Hiring","Investment","Policy"],"facet":[]},"layer":{"addYAxis":true,"addXAxis":true,"name":"Layer 0","z":2,"id":"0","base":true}}},"ornament":false},"lastTaskOptionsMap":{"0":{"options":{"0":{"layout":"Line","alignment":{"tooltip":[],"label":["month"],"value":["Collaborate","Complication","Develop","Hiring","Investment","Policy"],"facet":[]},"layer":{"addYAxis":true,"addXAxis":true,"name":"Layer 0","z":2,"id":"0","base":true}}},"ornament":false}},"lastFormatter":{"type":"TABLE","options":null},"lastFormatterMap":{"0":{"type":"TABLE","options":null}}}</encode>" ) ;
AddPanel ( panel = [ "1" ] , sheet = [ "0" ] ) ;
SetPanelState ( "<encode>{"panelId":"1","panelLabel":null,"sheetId":"0","view":"visualization","viewOptions":"{\"type\":\"standard\"}","numCollect":2000,"viewOptionsMap":{"visualization":{"type":"standard"}},"config":{},"ornaments":{},"events":{},"comments":{},"filters":[],"order":[],"cbv":[],"lastQs":{"qsType":"FRAME","frameName":"df","frameType":"PY","isDistinct":true,"overrideImplicit":false,"limit":2000,"offset":0,"queryAll":false,"selectors":[{"type":"COLUMN","content":{"table":"name","column":"PRIM_KEY_PLACEHOLDER","alias":"name","tableAlias":null}},{"type":"FUNCTION","content":{"alias":"Average_of_latitude","function":"Mean","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"latitude","column":"PRIM_KEY_PLACEHOLDER","alias":"latitude","tableAlias":null}}]}},{"type":"FUNCTION","content":{"alias":"Average_of_longitude","function":"Mean","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"longitude","column":"PRIM_KEY_PLACEHOLDER","alias":"longitude","tableAlias":null}}]}},{"type":"FUNCTION","content":{"alias":"Sum_of_keyword_count","function":"Sum","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"keyword_count","column":"PRIM_KEY_PLACEHOLDER","alias":"keyword_count","tableAlias":null}}]}}],"groups":[{"type":"COLUMN","content":{"table":"name","column":"PRIM_KEY_PLACEHOLDER","alias":"name","tableAlias":null}}],"withPanels":["1"]},"lastQueryStructMap":{"0":{"qsType":"FRAME","frameName":"df","frameType":"PY","isDistinct":true,"overrideImplicit":false,"limit":2000,"offset":0,"queryAll":false,"selectors":[{"type":"COLUMN","content":{"table":"name","column":"PRIM_KEY_PLACEHOLDER","alias":"name","tableAlias":null}},{"type":"FUNCTION","content":{"alias":"Average_of_latitude","function":"Mean","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"latitude","column":"PRIM_KEY_PLACEHOLDER","alias":"latitude","tableAlias":null}}]}},{"type":"FUNCTION","content":{"alias":"Average_of_longitude","function":"Mean","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"longitude","column":"PRIM_KEY_PLACEHOLDER","alias":"longitude","tableAlias":null}}]}},{"type":"FUNCTION","content":{"alias":"Sum_of_keyword_count","function":"Sum","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"keyword_count","column":"PRIM_KEY_PLACEHOLDER","alias":"keyword_count","tableAlias":null}}]}}],"groups":[{"type":"COLUMN","content":{"table":"name","column":"PRIM_KEY_PLACEHOLDER","alias":"name","tableAlias":null}}],"withPanels":["1"]}},"lastTaskOptions":{"options":{"1":{"layout":"Map","alignment":{"size":["Sum_of_keyword_count"],"color":[],"latitude":["Average_of_latitude"],"tooltip":[],"label":["name"],"facet":[],"longitude":["Average_of_longitude"]},"layer":{"addYAxis":true,"addXAxis":true,"name":"Layer 0","z":2,"id":"0","base":true}}},"ornament":false},"lastTaskOptionsMap":{"0":{"options":{"1":{"layout":"Map","alignment":{"size":["Sum_of_keyword_count"],"color":[],"latitude":["Average_of_latitude"],"tooltip":[],"label":["name"],"facet":[],"longitude":["Average_of_longitude"]},"layer":{"addYAxis":true,"addXAxis":true,"name":"Layer 0","z":2,"id":"0","base":true}}},"ornament":false}},"lastFormatter":{"type":"TABLE","options":null},"lastFormatterMap":{"0":{"type":"TABLE","options":null}}}</encode>" ) ;
AddPanel ( panel = [ "2" ] , sheet = [ "0" ] ) ;
SetPanelState ( "<encode>{"panelId":"2","panelLabel":null,"sheetId":"0","view":"dashboard-filter","viewOptions":"{\"frame\":\"df\",\"column\":\"keyword\",\"type\":\"checklist\",\"auto\":true,\"dynamic\":false,\"multiple\":true,\"searchable\":true,\"applied\":false}","numCollect":2000,"viewOptionsMap":{"dashboard-filter":{"frame":"df","column":"keyword","type":"checklist","auto":true,"dynamic":false,"multiple":true,"searchable":true,"applied":false}},"config":{"type":"golden"},"ornaments":{},"events":{"onSingleClick":{"Unfilter":[{"disabledVisuals":["Grid","Sunburst"],"default":true,"query":"(<Frame> | UnfilterFrame(<SelectedColumn>));","options":{},"refresh":false,"disabled":false,"panel":""}]},"onBrush":{"Filter":[{"default":true,"query":"if((IsEmpty(<SelectedValues>)),(<Frame> | UnfilterFrame(<SelectedColumn>)), (<Frame> | SetFrameFilter(<SelectedColumn>==<SelectedValues>)));","options":{},"refresh":false,"disabled":false,"panel":""}]}},"comments":{},"filters":[],"order":[],"cbv":[]}</encode>" ) ;
AddPanel ( panel = [ "3" ] , sheet = [ "0" ] ) ;
SetPanelState ( "<encode>{"panelId":"3","panelLabel":null,"sheetId":"0","view":"dashboard-filter","viewOptions":"{\"frame\":\"df\",\"column\":\"month\",\"type\":\"checklist\",\"auto\":true,\"dynamic\":false,\"multiple\":true,\"searchable\":true,\"applied\":false}","numCollect":2000,"viewOptionsMap":{"dashboard-filter":{"frame":"df","column":"month","type":"checklist","auto":true,"dynamic":false,"multiple":true,"searchable":true,"applied":false}},"config":{"type":"golden"},"ornaments":{},"events":{"onSingleClick":{"Unfilter":[{"disabledVisuals":["Grid","Sunburst"],"default":true,"query":"(<Frame> | UnfilterFrame(<SelectedColumn>));","options":{},"refresh":false,"disabled":false,"panel":""}]},"onBrush":{"Filter":[{"default":true,"query":"if((IsEmpty(<SelectedValues>)),(<Frame> | UnfilterFrame(<SelectedColumn>)), (<Frame> | SetFrameFilter(<SelectedColumn>==<SelectedValues>)));","options":{},"refresh":false,"disabled":false,"panel":""}]}},"comments":{},"filters":[],"order":[],"cbv":[]}</encode>" ) ;
AddPanel ( panel = [ "4" ] , sheet = [ "0" ] ) ;
SetPanelState ( "<encode>{"panelId":"4","panelLabel":null,"sheetId":"0","view":"visualization","viewOptions":"{\"type\":\"standard\"}","numCollect":2000,"viewOptionsMap":{"visualization":{"type":"standard"}},"config":{"type":"golden"},"ornaments":{},"events":{"onSingleClick":{"Unfilter":[{"disabledVisuals":["Grid","Sunburst"],"default":true,"query":"(<Frame> | UnfilterFrame(<SelectedColumn>));","options":{},"refresh":false,"disabled":false,"panel":""}]},"onBrush":{"Filter":[{"default":true,"query":"if((IsEmpty(<SelectedValues>)),(<Frame> | UnfilterFrame(<SelectedColumn>)), (<Frame> | SetFrameFilter(<SelectedColumn>==<SelectedValues>)));","options":{},"refresh":false,"disabled":false,"panel":""}]}},"comments":{},"filters":[],"order":[],"cbv":[],"lastQs":{"qsType":"FRAME","frameName":"df","frameType":"PY","isDistinct":true,"overrideImplicit":false,"limit":2000,"offset":0,"queryAll":false,"selectors":[{"type":"FUNCTION","content":{"alias":"Sum_of_keyword_count","function":"Sum","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"keyword_count","column":"PRIM_KEY_PLACEHOLDER","alias":"keyword_count","tableAlias":null}}]}}],"withPanels":["4"]},"lastQueryStructMap":{"0":{"qsType":"FRAME","frameName":"df","frameType":"PY","isDistinct":true,"overrideImplicit":false,"limit":2000,"offset":0,"queryAll":false,"selectors":[{"type":"FUNCTION","content":{"alias":"Sum_of_keyword_count","function":"Sum","distinct":false,"colCast":"","innerSelectors":[{"type":"COLUMN","content":{"table":"keyword_count","column":"PRIM_KEY_PLACEHOLDER","alias":"keyword_count","tableAlias":null}}]}}],"withPanels":["4"]}},"lastTaskOptions":{"options":{"4":{"layout":"KPI","alignment":{"dimension":["Sum_of_keyword_count"],"facet":[]},"layer":{"addYAxis":true,"addXAxis":true,"name":"Layer 0","z":2,"id":"0","base":true}}},"ornament":false},"lastTaskOptionsMap":{"0":{"options":{"4":{"layout":"KPI","alignment":{"dimension":["Sum_of_keyword_count"],"facet":[]},"layer":{"addYAxis":true,"addXAxis":true,"name":"Layer 0","z":2,"id":"0","base":true}}},"ornament":false}},"lastFormatter":{"type":"TABLE","options":null},"lastFormatterMap":{"0":{"type":"TABLE","options":null}}}</encode>" ) ;
JdbcSource ( conDetails = [ { "dbDriver" : "POSTGRES" , "hostname" : "db-postgres-prod-preprod.ckxhtnyisce2.us-east-1.rds.amazonaws.com" , "port" : "5432" , "schema" : "bridgeapp" , "database" : "dsb-foc" , "USERNAME" : "svc-dsb-readonly" , "PASSWORD" : "gM2csehYnghH" } ] ) | Query ( "<encode>select to_char(date(ds.published_date), 'Month') as month, count(o.keyword) as keyword_count, o.keyword, ai.news_country
from bridgeapp.alert_keywords as ak
left join bridgeapp.alert_info as ai on ak.alert_id = ai.alert_id
left join bridgeapp.ontology as o on ak.keyword_id = o.keyword_id
left join bridgeapp.data_table as ds on ai.hash = ds.hash
where workflow_status >= 400
  and workflow_status < 499
  and ak.is_active is true
  and (o.taxonomy_root = 2 or o.taxonomy_root = 3 or o.taxonomy_root = 4)
  and ds.published_date is not null
  and ai.news_country is not null
group by month, keyword, ai.news_country
order by month;</encode>" ) | Import ( frame = [ CreateFrame ( frameType = [ GRID ] , override = [ true ] ) .as ( [ "POSTGRES_FRAME833680" ] ) ] ) ;
FileRead ( filePath = [ "data/country_lat_long.csv" ] , dataTypeMap = [ { "country" : "STRING" , "latitude" : "DOUBLE" , "longitude" : "DOUBLE" , "name" : "STRING" } ] , delimiter = [ "," ] , newHeaders = [ { } ] , fileName = [ "country_lat_long.csv" ] , additionalDataTypes = [ { "latitude" : "double_round2" , "longitude" : "double_round2" } ] ) | Select ( DND__country , DND__latitude , DND__longitude , DND__name ) .as ( [ country , latitude , longitude , name ] ) | Import ( frame = [ CreateFrame ( frameType = [ GRID ] , override = [ true ] ) .as ( [ "country_lat_long_csv_FRAME266601" ] ) ] ) ;
Frame ( POSTGRES_FRAME833680 ) | QueryAll ( ) | Distinct ( true ) | Merge ( joins = [ ( name , inner.join , news_country ) ] , frame = [ country_lat_long_csv_FRAME266601 ] ) ;
country_lat_long_csv_FRAME266601 | Convert ( "PY" ) ;
Py ( "<encode>df = country_lat_long_csv_FRAME266601</encode>" ) ;
Py ( "<encode>months = ['May','June','July','August','September']
df = df.sort_values('month', key = lambda x : pd.Categorical(x, categories=months, ordered=True))</encode>" ) ;
Py ( "<encode>df</encode>" ) ;
Py ( "<encode>months = ['May','June','July','August','September']</encode>" ) ;
Py ( "<encode>df['month']=df['month'].str.strip()</encode>" ) ;
Py ( "<encode>df</encode>" ) ;
Py ( "<encode>df['month']=df['month'].str.strip()</encode>" ) ;
Py ( "<encode>df = df.sort_values('month', key = lambda x : pd.Categorical(x, categories=months, ordered=True))</encode>" ) ;
Py ( "<encode>df</encode>" ) ;
GenerateFrameFromPyVariable ( "df" ) ;
JdbcSource ( conDetails = [ { "dbDriver" : "POSTGRES" , "hostname" : "db-postgres-prod-preprod.ckxhtnyisce2.us-east-1.rds.amazonaws.com" , "port" : "5432" , "schema" : "bridgeapp" , "database" : "dsb-foc" , "USERNAME" : "svc-dsb-readonly" , "PASSWORD" : "gM2csehYnghH" } ] ) | Query ( "<encode>select  to_char(date(ds.published_date), 'Month') as month, o.keyword, count(ai.title)
from bridgeapp.alert_keywords as ak
left join bridgeapp.alert_info as ai on ak.alert_id = ai.alert_id
left join bridgeapp.ontology as o on ak.keyword_id = o.keyword_id
left join bridgeapp.data_table as ds on ai.hash = ds.hash
where workflow_status >= 400
  and workflow_status < 499
  and ak.is_active is true
  and (o.taxonomy_root = 6)
  and ds.published_date is not null
group by month, o.keyword
order by month, o.keyword;</encode>" ) | Import ( frame = [ CreateFrame ( frameType = [ GRID ] , override = [ true ] ) .as ( [ "POSTGRES_FRAME741331" ] ) ] ) ;
POSTGRES_FRAME741331 | Convert ( frameType = [ R ] ) .as ( [ 'POSTGRES_FRAME741331' ] ) ;
POSTGRES_FRAME741331 | Pivot ( pivotCol = [ "keyword" ] , valueCol = [ "count" ] , function = [ "" ] , maintainCols = [ "month" ] ) ;
if ( ( POSTGRES_FRAME741331 | HasDuplicates ( month ) ) , ( ( Frame ( frame = [ POSTGRES_FRAME741331 ] ) | Select ( month , Average ( Collaborate ) , Average ( Complication ) , Average ( Develop ) , Average ( Hiring ) , Average ( Investment ) , Average ( Policy ) ) .as ( [ month , Average_of_Collaborate , Average_of_Complication , Average_of_Develop , Average_of_Hiring , Average_of_Investment , Average_of_Policy ] ) | Group ( month ) | With ( Panel ( 0 ) ) | Format ( type = [ 'table' ] ) | TaskOptions ( { "0" : { "layout" : "Line" , "alignment" : { "label" : [ "month" ] , "value" : [ "Average_of_Collaborate" , "Average_of_Complication" , "Average_of_Develop" , "Average_of_Hiring" , "Average_of_Investment" , "Average_of_Policy" ] , "tooltip" : [ ] , "facet" : [ ] } , "layer" : { "id" : "0" , "name" : "Layer 0" , "addYAxis" : true , "addXAxis" : true , "z" : 2 , "base" : true } } } ) | Collect ( 2000 ) ) ) , ( ( Frame ( frame = [ POSTGRES_FRAME741331 ] ) | Select ( month , Collaborate , Complication , Develop , Hiring , Investment , Policy ) .as ( [ month , Collaborate , Complication , Develop , Hiring , Investment , Policy ] ) | With ( Panel ( 0 ) ) | Format ( type = [ 'table' ] ) | TaskOptions ( { "0" : { "layout" : "Line" , "alignment" : { "label" : [ "month" ] , "value" : [ "Collaborate" , "Complication" , "Develop" , "Hiring" , "Investment" , "Policy" ] , "tooltip" : [ ] , "facet" : [ ] } , "layer" : { "id" : "0" , "name" : "Layer 0" , "addYAxis" : true , "addXAxis" : true , "z" : 2 , "base" : true } } } ) | Collect ( 2000 ) ) ) ) ;
if ( ( df | HasDuplicates ( name ) ) , ( ( Frame ( frame = [ df ] ) | Select ( name , Average ( latitude ) , Average ( longitude ) , Sum ( keyword_count ) ) .as ( [ name , Average_of_latitude , Average_of_longitude , Sum_of_keyword_count ] ) | Group ( name ) | With ( Panel ( 1 ) ) | Format ( type = [ 'table' ] ) | TaskOptions ( { "1" : { "layout" : "Map" , "alignment" : { "label" : [ "name" ] , "latitude" : [ "Average_of_latitude" ] , "longitude" : [ "Average_of_longitude" ] , "size" : [ "Sum_of_keyword_count" ] , "color" : [ ] , "tooltip" : [ ] , "facet" : [ ] } , "layer" : { "id" : "0" , "name" : "Layer 0" , "addYAxis" : true , "addXAxis" : true , "z" : 2 , "base" : true } } } ) | Collect ( 2000 ) ) ) , ( ( Frame ( frame = [ df ] ) | Select ( name , latitude , longitude , keyword_count ) .as ( [ name , latitude , longitude , keyword_count ] ) | With ( Panel ( 1 ) ) | Format ( type = [ 'table' ] ) | TaskOptions ( { "1" : { "layout" : "Map" , "alignment" : { "label" : [ "name" ] , "latitude" : [ "latitude" ] , "longitude" : [ "longitude" ] , "size" : [ "keyword_count" ] , "color" : [ ] , "tooltip" : [ ] , "facet" : [ ] } , "layer" : { "id" : "0" , "name" : "Layer 0" , "addYAxis" : true , "addXAxis" : true , "z" : 2 , "base" : true } } } ) | Collect ( 2000 ) ) ) ) ;
Frame ( frame = [ df ] ) | Select ( Sum ( keyword_count ) ) .as ( [ Sum_of_keyword_count ] ) | With ( Panel ( 4 ) ) | Format ( type = [ 'table' ] ) | TaskOptions ( { "4" : { "layout" : "KPI" , "alignment" : { "dimension" : [ "Sum_of_keyword_count" ] , "facet" : [ ] } , "layer" : { "id" : "0" , "name" : "Layer 0" , "addYAxis" : true , "addXAxis" : true , "z" : 2 , "base" : true } } } ) | Collect ( 2000 ) ;
df | Convert ( frameType = [ R ] ) .as ( [ 'df' ] ) ;
Frame ( frame = [ df ] ) | Select ( country , keyword , keyword_count , latitude , longitude , month , name ) .as ( [ country , keyword , keyword_count , latitude , longitude , month , name ] ) | Format ( type = [ 'table' ] ) | TaskOptions ( { "4" : { "layout" : "Grid" , "alignment" : { "label" : [ "country" , "keyword" , "keyword_count" , "latitude" , "longitude" , "month" , "name" ] } } } ) | Collect ( 2000 ) ;